---
title: Dashboard
---

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% if page.title %}{{ page.title | strip_html }} &#8211; {% endif %}{{ site.title | strip_html }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{% if page.summary %}{{ page.summary | xml_escape }}{% else %}{{ site.description | xml_escape }}{% endif %}">
    <meta name="author" content="{{ site.author }}">
    {% if page.categories %}<meta name="keywords" content="{{ page.categories | join: ', ' }}">{% endif %}
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for {{ site.title }}" href="{{ "/feed.xml" | prepend: site.baseurl }}" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ "/css/style.css" | prepend: site.baseurl }}?{{ site.time | date: "%Y%m%d%H%M" }}" type="text/css">
    <link rel="stylesheet" href="../css/Grid.css" type="text/css">
    <link rel="stylesheet" href="../css/balloon.css" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    {% if site.show_social_icons or site.show_sharing_icons %}
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    {% endif %}

    <!-- Verifications -->
    {% if site.google_verification %}
      <meta name="google-site-verification" content="{{ site.google_verification }}" />
    {% endif %}

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="{% if page.title %}{{ page.title | xml_escape }}{% else %}{{ site.title | xml_escape }}{% endif %}">
    <meta property="og:description" content="{% if page.excerpt %}{{ page.excerpt | xml_escape }}{% else %}{{ site.description | xml_escape }}{% endif %}">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:site_name" content="{{ site.title | xml_escape }}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    {% if site.twitter_username %}
        <meta name="twitter:site" content="@{{ site.twitter_username }}" />
    {% endif %}
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}" />
    <meta name="twitter:description" content="{% if page.excerpt %}{{ page.excerpt | xml_escape }}{% else %}{{ site.description | xml_escape}}{% endif %}" />
    <meta name="twitter:url" content="{{ site.url }}{{ page.url }}" />

    <!-- Icons -->

    <link rel="icon" type="image/png" href="{{site.baseurl}}/images/favicon.png">

    {% if site.google_analytics %}
    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '{{site.google_analytics}}', 'auto');
    ga('send', 'pageview');
    </script>
    {% endif %}
    <script src="{{ "/js/findandreplace.js" | prepend: site.baseurl }}"></script>
</head>

<body class="site{% if site.animated %} animated fade-in-down{% endif %}">

{% include html/header.html headerimage="/images/header/stories_header.png" %}
    <div class="content-wrapper">
        <div class="container" role="{{page.role}}">
            {% if page.menus %}
            <div class="col-sm-4 col-md-4 visible-xs-inline">
                {% for menu in page.menus %} {% include menus/{{menu}} %} {% endfor %}
            </div>

                {% endif %}
            <div class="row">
                <div class="{% if page.menus %}col-xs-12 col-sm-8 col-md-8 {% else %}{% endif %} {% if page.menus %}right-divider {% endif %}">
                    <div id="content" >
                <article class="post-content">
                <div id="dash"></div>
 </div>
                </div>
                {% if page.menus %}
                <div class="col-sm-4 col-md-4 hidden-xs">
                    {% for menu in page.menus %} {% include menus/{{menu}} %} {% endfor %}
                </div>
                {% endif %}
            </div>
            <!--/row -->
        </div>
        {% include html/footer.html %}
    </div>


        <script src="../vendor/raphael-2.1.4.min.js"></script>
        <script src="../vendor/justgage.js"></script>
        <script src="../vendor/tabletop.js"></script>
        <script src="../vendor/papa.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>

<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
        <script src="../dash.js"></script>
        
        <script>
            var app = Elm.Dash.embed(document.getElementById("dash"));      
            var elem = document.querySelector('.grid');
            var chart_dict = {}

            function classSafe(string){
                return string.replace(".","0").replace(" ","0")
            }

            function builder(tuple, location){
                app.ports.status.send("Creating chart for "+tuple[3]);
                var node = document.createElement("div");
                var child = document.createElement("div");
                
        
                switch (location) {
                    case "circle_container":
                         node.setAttribute("class", ("Grid-cell " + "circle district-"+classSafe(tuple[4]) +" tahasil-"+classSafe(tuple[5])));
                         node.setAttribute("data-balloon", "RI: "+tuple[6]+" ("+tuple[7]+")")
                         node.setAttribute("data-balloon-pos", "up")
                         node.setAttribute("id", "district-"+classSafe(tuple[4]) +"-tahasil-"+classSafe(tuple[0].toString())+"-circle-"+classSafe(tuple[3].toString()));
                         node.setAttribute("data-balloon-length", "fit")
                         break;
                    case "tahasil_container":
                         node.setAttribute("class", ("hint-top Grid-cell " + "tahasil district-"+classSafe(tuple[4]) +" tahasil-"+classSafe(tuple[3])));
                         node.setAttribute("data-balloon", "Tahasildar: "+tuple[5]+" ("+tuple[6]+")")
                         node.setAttribute("id", "district-"+classSafe(tuple[4]) +"-tahasil-"+classSafe(tuple[0].toString()));
                          node.setAttribute("data-balloon-pos", "up")
                         node.setAttribute("data-balloon-length", "fit")
                         break;

                    case "district_container":
                         node.setAttribute("class", ("Grid-cell " + "district district-"+classSafe(tuple[0])))
                         node.setAttribute("id", "district-"+classSafe(tuple[0].toString()));
                         break; 
                    
                    case "super":
                        node.setAttribute("class", ("Grid-cell " + "state"));
                        break;
                    
                    default:
                        node.setAttribute("class", ("Grid-cell " + "state"));
                        break;
                }
               
                var container = document.getElementById(location);
                container.setAttribute("class", "Grid")
                node.appendChild(child,node.childNodes[0]);
                container.appendChild(node, container.childNodes[0]);
                container = null;
                chart_dict[tuple[0]] = newGage(tuple[0], tuple[1], tuple[2], tuple[3].toString(), node.getAttribute("id") );
                node = null;
                child = null
                app.ports.status.send("Ready to go. Hover over individual tahasils and circles for official contact information.");
            }

            app.ports.build_circle.subscribe(function(tuple){
                builder(tuple, "circle_container")
            });

           app.ports.build_tahasil.subscribe(function(tuple){
                builder(tuple, "tahasil_container")
            })

            app.ports.build_district.subscribe(function(tuple){
                builder(tuple, "district_container")
            })

            app.ports.show.subscribe(function(id){
                document.getElementById(id.toString()).style.display = "";
            })
            app.ports.hide.subscribe(function(id){
                document.getElementById(id.toString()).style.display = "none";
            })

            app.ports.update_chart.subscribe(function(tuple){
                //chart_dict[tuple[0]].refresh(tuple[2], tuple[1], tuple[3])
            })

            
            


            
            
            var byteEncode = function(text){
            encoder = new TextEncoder()
            return encoder.encode(text)
            }
            app.ports.export_csv.subscribe(function(data){
                var textFile = make_csv(data)
                app.ports.download_url.send(textFile);
    
            });
            
            function cleanup(data){
                var cleaned = data.map(function(chart){
                    return {                    
                        "District": chart.district,
                        "Tahasil": chart.tahasil,
                        "Circle": chart.circle,
                        "Households Identified": chart.households_identified,
                        "Patta Distributed": chart.households_pattas_distributed
                    }
                })
                return cleaned;
            }

            function make_csv(data){

                //filter data
                var cleaned = cleanup(data)
                 var csv = Papa.unparse(cleaned)
               
                var reader = new FileReader();
                var textFile = null
                var data = new Blob([byteEncode(csv)], {type: "text/csv"});

                // If we are replacing a previously generated file we need to
                // manually revoke the object URL to avoid memory leaks.
                if (textFile !== null) {
                window.URL.revokeObjectURL(textFile);
                }

                textFile = window.URL.createObjectURL(data);
                return textFile;
            }

            function is_district(){
                var match = /#(\w+)$/
                var finder = window.location.href.match(match)
                if (finder == null) {return false}
                else {return finder[1]}
            }

            function filter_data_by_district(data, district){
                
            
                if (district == false){
                    return data.filter(function(circle){return circle.district.toLowerCase()!="landesa"});
                }
                else{
                    filtered_data = data.filter(function(circle){
                        return circle.district.toLowerCase() == district
                    })
                if (filtered_data.length > 0){return filtered_data;}
                else {return data;}
                }
            }

            function filter_data_by_tahasil(data, district, tahasil){
                
        
                if (district == false || tahasil == false){return data;}
                else{
                    filtered_data = data.filter(function(circle){
                        return ((circle.district.toLowerCase() == district) && (circle.tahasil.toLowerCase() == tahasil))
                    })
                if (filtered_data.length > 0){return filtered_data;}
                else {return data;}
                }
            }
            

        </script>
        <script>
            function newGage (id, max, value, title, node){
                var gaugeOptions = {

                chart: {
                    type: 'solidgauge'
                },

                title: false,

                pane: {
                    center: ['50%', '85%'],
                    size: '100%',
                    startAngle: -90,
                    endAngle: 90,
                    background: {
                        backgroundColor: '#EEE',
                        innerRadius: '60%',
                        outerRadius: '100%',
                        shape: 'arc'
                    }
                },

                tooltip: {
                    enabled: false
                },

                // the value axis
                yAxis: {
                    stops: [
                         [0.1, '#DF5353'], // green
                        [0.5, '#DDDF0D'],  // yellow
                        [0.9, '#55BF3B'], // red
                    ],
                    lineWidth: 0,
                    minorTickInterval: null,
                    tickAmount: 2,
                    title: {
                        y: -70
                    },
                    labels: {
                        y: 16
                    }
                },

                plotOptions: {
                    solidgauge: {
                        dataLabels: {
                            y: 5,
                            borderWidth: 0,
                            useHTML: false
                        }
                    }
                }
            };
                  var chartSpeed = Highcharts.chart(node, Highcharts.merge(gaugeOptions, {
                    yAxis: {
                        min: 0,
                        max: max,
                        title: {
                            text: title,
                            style: {
                                fontSize: "20px",
                                color: setColor(max, value)
                            },
                            y: 20
                        }
                    },

                    credits: {
                        enabled: false
                    },

                    series: [{
                        name: 'Speed',
                        data: [value],                       
                        tooltip: {
                            valueSuffix: ' km/h'
                        }
                    }]

                }));

                chartSpeed.reflow()

                return chartSpeed

            }
            function setColor(max, value){
                if (max == 0 || value / max < .5){
                    return "#ff0000"
                }
                else if (value > max){
                    return "#0000ff"
                }
                else{
                    return "#010101"
                }
            }
        </script>

        <script>
         window.onload = function() { tableinit(); };
            app.ports.status.send("Requesting data and building charts, please wait. This may take 1-2 minutes...")
            var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1h3eyB6G0qa-7Y4eFFBJdPssarBGd1H43GNccc8dJ6Q8/pubhtml?gid=0&single=true';

            function tableinit() {
                Tabletop.init( { key: public_spreadsheet_url,
                                callback: showInfo,
                                simpleSheet: true } )
            }

            var deposit;
            function showInfo(data, tabletop) {
                var district = is_district();
                var filtered = filter_data_by_district(data, district)
                app.ports.status.send("Processing data...");
                app.ports.charts.send(filtered);
                if (district){
                    app.ports.filtered.send(district)
                }
                 var file = make_csv(filtered);
                app.ports.download_url.send(file);
                var node = document.createElement("div")
                //node.setAttribute("id", "0");
                var container = document.getElementById("super");
               // chart_dict[0] = newGage(0, 1, 2, "State", node);


                app.ports.filter_district.subscribe(function(selected_district){
                    //reset
                    var all = document.getElementsByClassName('Grid-cell'), i;
                    for (var i = 0; i < all.length; i ++) {
                        all[i].style.display = 'none';
                    }
                    var show = document.getElementsByClassName('district-'+classSafe(selected_district)), l;
                    for (var l = 0; l < show.length; l ++) {
                        show[l].style.display = "inherit";
                    }

                    var new_filtered = filter_data_by_district(data, selected_district.toLowerCase())
                    var filtered_file = make_csv(new_filtered);
                    app.ports.download_url.send(filtered_file);
                })

                app.ports.filter_tahasil.subscribe(function(tuple){
                    //reset
                    var all = document.getElementsByClassName('Grid-cell'), i;
                    for (var i = 0; i < all.length; i ++) {
                        all[i].style.display = 'none';
                    }
                    var circles = document.getElementsByClassName('Grid-cell circle district-'+classSafe(tuple[0])+' tahasil-'+classSafe(tuple[1])), j;
                    if (circles){
                        for (var j = 0; j < circles.length; j ++) {
                        circles[j].style.display = "inherit";
                        }
                    }
                    var tahasils = document.getElementsByClassName('Grid-cell tahasil district-'+classSafe(tuple[0])+' tahasil-'+classSafe(tuple[1])), k;
                    console.log(tuple);
                    console.log('Grid-cell tahasil district-'+classSafe(tuple[0])+' tahasil-'+classSafe(tuple[1]))
                    if (tahasils){
                        for (var k = 0; k < tahasils.length; k ++) {
                            tahasils[k].style.display = "inherit";
                        }
                    }
                    var districts = document.getElementsByClassName('district district-'+classSafe(tuple[0])), l;
                    for (var l = 0; l < districts.length; l ++) {
                        districts[l].style.display = "inherit";
                    }

                    var new_filtered = filter_data_by_tahasil(data, classSafe(tuple[0]).toLowerCase(), classSafe(tuple[1]).toLowerCase())
                    var filtered_file = make_csv(new_filtered);
                    app.ports.download_url.send(filtered_file);
                })

            app.ports.filter_none.subscribe(function(int){
                //reset
                var all = document.getElementsByClassName('Grid-cell'), i;
                for (var i = 0; i < all.length; i ++) {
                    all[i].style.display = "inherit";
                }
                var file = make_csv(filtered);
                app.ports.download_url.send(file);
            })

            }
            
            

        </script>
</body>
</html>
